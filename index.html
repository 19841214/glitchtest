<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>1938 訊號修復行動</title>
    <style>
        body { background: #050505; color: #0f0; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #container { position: relative; width: 600px; height: 400px; border: 2px solid #333; box-shadow: 0 0 20px rgba(0, 255, 0, 0.2); }
        canvas { width: 100%; height: 100%; display: block; }
        .controls { margin-top: 20px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; background: #111; padding: 20px; border-radius: 8px; }
        .slider-group { display: flex; flex-direction: column; align-items: center; }
        label { font-size: 12px; margin-bottom: 5px; }
        input[type=range] { width: 100px; cursor: pointer; }
        #message { margin-top: 15px; font-weight: bold; min-height: 20px; }
        .success { color: #fff; text-shadow: 0 0 10px #0f0; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

    <div id="message">警告：校史訊號遺失...請同步頻率</div>
    
    <div id="container">
        <canvas id="glitchCanvas"></canvas>
    </div>

    <div class="controls">
        <div class="slider-group">
            <label>頻率 (F)</label>
            <input type="range" id="s1" min="0" max="9" value="5">
        </div>
        <div class="slider-group">
            <label>相位 (P)</label>
            <input type="range" id="s2" min="0" max="9" value="2">
        </div>
        <div class="slider-group">
            <label>增益 (G)</label>
            <input type="range" id="s3" min="0" max="9" value="7">
        </div>
        <div class="slider-group">
            <label>解碼 (D)</label>
            <input type="range" id="s4" min="0" max="9" value="0">
        </div>
    </div>

    <script>
        const canvas = document.getElementById('glitchCanvas');
        const ctx = canvas.getContext('2d');
        const sliders = [document.getElementById('s1'), document.getElementById('s2'), document.getElementById('s3'), document.getElementById('s4')];
        const msg = document.getElementById('message');
        const target = [1, 9, 3, 8];

        canvas.width = 600;
        canvas.height = 400;

        function draw() {
            const vals = sliders.map(s => parseInt(s.value));
            const diff = vals.reduce((acc, v, i) => acc + Math.abs(v - target[i]), 0);
            const isSuccess = diff === 0;

            // 清除背景
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (isSuccess) {
                // 成功畫面：顯示文字或圖片
                ctx.fillStyle = '#0f0';
                ctx.font = 'bold 40px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText("SIGNAL RESTORED", canvas.width/2, 180);
                ctx.font = '20px Courier New';
                ctx.fillText("創校年份：1938", canvas.width/2, 230);
                msg.innerText = "訊號修復成功！彰師附工精神永傳。";
                msg.className = "success";
            } else {
                // 雜訊畫面：diff 越小，雜訊越弱
                const noiseDensity = Math.min(diff * 0.1, 1.0);
                
                // 繪製隨機白噪點
                const imageData = ctx.createImageData(canvas.width, canvas.height);
                for (let i = 0; i < imageData.data.length; i += 4) {
                    const noise = Math.random() * 255 * noiseDensity;
                    imageData.data[i] = noise;     // R
                    imageData.data[i+1] = noise;   // G
                    imageData.data[i+2] = noise;   // B
                    imageData.data[i+3] = 255;     // A
                }
                ctx.putImageData(imageData, 0, 0);

                // 繪製掃描線效果
                ctx.strokeStyle = `rgba(0, 255, 0, ${0.1 + Math.random() * 0.1})`;
                for (let i = 0; i < canvas.height; i += 4) {
                    ctx.beginPath();
                    ctx.moveTo(0, i + Math.sin(Date.now()*0.01)*2);
                    ctx.lineTo(canvas.width, i);
                    ctx.stroke();
                }

                // 隨機文字干擾
                if (Math.random() > 0.9) {
                    ctx.fillStyle = "rgba(0, 255, 0, 0.5)";
                    ctx.fillText("RECOVERING...", Math.random()*canvas.width, Math.random()*canvas.height);
                }
                msg.innerText = "警告：校史訊號遺失...偏差值: " + diff;
                msg.className = "";
            }

            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>