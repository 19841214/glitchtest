<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1938 訊號修復行動 - 彰師附工</title>
    <style>
        body { background: #000; color: #0f0; font-family: 'Microsoft JhengHei', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; overflow: hidden; }
        #message { margin-bottom: 20px; font-size: 1.2rem; letter-spacing: 2px; text-shadow: 0 0 5px #0f0; height: 30px; }
        #container { position: relative; width: 600px; height: 400px; border: 3px solid #333; overflow: hidden; background: #050505; box-shadow: 0 0 30px rgba(0, 255, 0, 0.1); }
        canvas { width: 100%; height: 100%; display: block; }
        .controls { margin-top: 30px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; padding: 25px; background: rgba(255, 255, 255, 0.05); border-radius: 15px; border: 1px solid #222; }
        .slider-group { display: flex; flex-direction: column; align-items: center; }
        label { font-size: 20px; margin-bottom: 10px; color: #aaa; font-weight: bold; }
        input[type=range] { -webkit-appearance: none; width: 100px; height: 4px; background: #444; border-radius: 5px; outline: none; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: #0f0; border-radius: 50%; box-shadow: 0 0 10px #0f0; }
        .success-text { color: #fff !important; text-shadow: 0 0 20px #0f0; animation: glow 1s infinite alternate; }
        @keyframes glow { from { opacity: 0.7; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="message">系統提示：校史核心訊號干擾中...</div>
    
    <div id="container">
        <canvas id="glitchCanvas"></canvas>
    </div>

    <div class="controls">
        <div class="slider-group">
            <label>誠</label>
            <input type="range" id="s1" min="0" max="9" value="0">
        </div>
        <div class="slider-group">
            <label>正</label>
            <input type="range" id="s2" min="0" max="9" value="0">
        </div>
        <div class="slider-group">
            <label>專</label>
            <input type="range" id="s3" min="0" max="9" value="0">
        </div>
        <div class="slider-group">
            <label>精</label>
            <input type="range" id="s4" min="0" max="9" value="0">
        </div>
    </div>

    <script>
        const canvas = document.getElementById('glitchCanvas');
        const ctx = canvas.getContext('2d');
        const sliders = [
            document.getElementById('s1'), 
            document.getElementById('s2'), 
            document.getElementById('s3'), 
            document.getElementById('s4')
        ];
        const msg = document.getElementById('message');
        const target = [1, 9, 3, 8]; // 創校年份：1938
        
        const logo = new Image();
        logo.crossOrigin = "anonymous";
        logo.src = 'https://i.postimg.cc/cHZ70FWn/Logo-SIVC.jpg';

        canvas.width = 600;
        canvas.height = 400;

        function draw() {
            const vals = sliders.map(s => parseInt(s.value));
            // 計算偏差值
            const diff = vals.reduce((acc, v, i) => acc + Math.abs(v - target[i]), 0);
            const isSuccess = (diff === 0);

            // 背景填黑
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (isSuccess) {
                // 成功狀態：清晰顯示
                ctx.globalAlpha = 1.0;
                ctx.drawImage(logo, (canvas.width - 250) / 2, 40, 250, 250);
                
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 30px Microsoft JhengHei';
                ctx.textAlign = 'center';
                ctx.fillText("創校年份：1938", canvas.width / 2, 350);
                
                msg.innerText = "訊號完全同步！誠正專精，附工精神。";
                msg.className = "success-text";
            } else {
                // 訊號修復中狀態
                const totalPossibleDiff = 36; // 最大誤差 (9*4)
                const syncRate = 1 - (diff / totalPossibleDiff); 
                
                // 1. 繪製校徽 (透明度隨同步率增加)
                ctx.save();
                ctx.globalAlpha = Math.pow(syncRate, 5); // 讓影像在接近正確答案時才清晰
                ctx.drawImage(logo, (canvas.width - 250) / 2, 40, 250, 250);
                ctx.restore();

                // 2. 隨機靜電雜訊 (Static Noise)
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                const noiseStrength = (1 - syncRate) * 255;

                for (let i = 0; i < data.length; i += 4) {
                    if (Math.random() > syncRate) {
                        const r = Math.random() * noiseStrength;
                        data[i] = data[i+1] = data[i+2] = r; 
                        // data[i+3] 保持原透明度
                    }
                }
                ctx.putImageData(imageData, 0, 0);

                // 3. CRT 掃描線效果 (Scanlines)
                ctx.fillStyle = "rgba(0, 255, 0, 0.05)";
                for (let i = 0; i < canvas.height; i += 3) {
                    ctx.fillRect(0, i, canvas.width, 1);
                }

                // 4. 隨機 Glitch 橫移效果
                if (Math.random() > 0.8) {
                    const sliceY = Math.random() * canvas.height;
                    const sliceH = Math.random() * 20;
                    const offset = (Math.random() - 0.5) * 40 * (1 - syncRate);
                    ctx.drawImage(canvas, 0, sliceY, canvas.width, sliceH, offset, sliceY, canvas.width, sliceH);
                }

                msg.innerText = `搜尋訊號中... 同步率: ${Math.floor(syncRate * 100)}%`;
                msg.className = "";
            }

            requestAnimationFrame(draw);
        }

        logo.onload = () => {
            console.log("Logo loaded");
            draw();
        };

        // 監聽滑桿變動，即時更新訊息色彩
        sliders.forEach(s => s.addEventListener('input', () => {
            if(msg.className !== "success-text") {
                msg.style.color = `rgb(${255 * (1-parseInt(s.value)/9)}, 255, ${255 * (parseInt(s.value)/9)})`;
                // 這裡的小彩蛋：顏色會隨滑桿微變
                msg.style.color = "#0f0";
            }
        }));
    </script>
</body>
</html>